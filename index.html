<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

<title>ADHD Reader</title>

<link rel="stylesheet" href="styles.css">


</head>
<body>

<div id="controls">
    <textarea id="textInput" placeholder="Paste your text here..."></textarea>
    <button id="playBtn">▶ Play</button>
    <button id="speedBtn">⚡</button>
    <div id="sliderContainer">
        <span id="wpmLabel">250 WPM</span>
        <input type="range" id="wpmSlider" min="100" max="600" step="25" value="250">
    </div>
</div>

<div id="reader">
    <div id="wordDisplay" class="word"></div>
</div>


<script>
let words = [];
let index = 0;
let timer = null;
let wpm = 300;
let playing = false;

const textInput = document.getElementById("textInput");
const playBtn = document.getElementById("playBtn");
const speedBtn = document.getElementById("speedBtn");
const sliderContainer = document.getElementById("sliderContainer");
const wpmSlider = document.getElementById("wpmSlider");
const wpmLabel = document.getElementById("wpmLabel");
const reader = document.getElementById("reader");
const wordDisplay = document.getElementById("wordDisplay");
const controls = document.getElementById("controls");

/* ---------- ORP ---------- */
function getORPIndex(word) {
    const len = word.length;
    if (len <= 2) return 0;
    if (len <= 5) return 1;
    if (len <= 9) return 2;
    return 2;
}

function renderWord(rawWord) {
    let word = rawWord;
    let hasDot = false;

    if (word.endsWith(".")) {
        hasDot = true;
        word = word.slice(0, -1);
    }

    const i = getORPIndex(word);
    const before = word.slice(0, i);
    const orp = word[i] || "";
    const after = word.slice(i + 1);

    const dot = hasDot
        ? `<span style="color: cyan;">.</span>`
        : "";

    wordDisplay.innerHTML =
        `<span>${before}</span>` +
        `<span class="orp">${orp}</span>` +
        `<span>${after}</span>` +
        dot;
}

/* ---------- TIMING ---------- */
function getWordDelay(word) {
    let effectiveWpm = wpm;
    if (word.length > 6) effectiveWpm = Math.round(wpm * 0.8);

    let delay = 60000 / effectiveWpm;

    if (word.endsWith(".")) delay += 400;

    return delay;
}

function playNextWord() {
    if (!playing) return;

    if (index >= words.length) {
        stopReading();
        return;
    }

    const word = words[index];
    renderWord(word);
    index++;

    timer = setTimeout(playNextWord, getWordDelay(word));
}

/* ---------- READER CONTROL ---------- */
function startReading() {
    words = textInput.value.trim().split(/\s+/);
    if (!words.length) return;

    index = 0;
    playing = true;

    reader.style.display = "flex";
    controls.style.display = "none";
    reader.classList.remove("paused");

    playNextWord();
}

function stopReading() {
    clearTimeout(timer);
    timer = null;
    playing = false;

    reader.style.display = "none";
    controls.style.display = "flex";
    reader.classList.remove("paused");
}

/* ---------- UI ---------- */
playBtn.onclick = startReading;

speedBtn.onclick = () => {
    sliderContainer.style.display =
        sliderContainer.style.display === "flex" ? "none" : "flex";
};

wpmSlider.oninput = () => {
    wpm = Number(wpmSlider.value);
    wpmLabel.textContent = `${wpm} WPM`;
};

wpmLabel.textContent = `${wpm} WPM`;

/* ---------- TEXTAREA AUTO-GROW ---------- */
function autoGrow(textarea) {
    textarea.style.height = "auto";
    textarea.style.height = textarea.scrollHeight + "px";
}

textInput.addEventListener("input", () => autoGrow(textInput));

/* ---------- KEYBOARD ---------- */
document.addEventListener("keydown", (e) => {
    const readerActive = reader.style.display === "flex";

    if (e.code === "Escape" && readerActive) {
        e.preventDefault();
        stopReading();
        return;
    }

    if (e.code === "Space" && readerActive) {
        e.preventDefault();

        if (playing) {
            clearTimeout(timer);
            timer = null;
            playing = false;
            reader.classList.add("paused");
        } else {
            playing = true;
            reader.classList.remove("paused");
            playNextWord();
        }
        return;
    }

    if (readerActive && !playing) {
        if (e.code === "ArrowLeft" && index > 0) {
            e.preventDefault();
            index--;
            renderWord(words[index]);
        }

        if (e.code === "ArrowRight" && index < words.length) {
            e.preventDefault();
            renderWord(words[index]);
            index++;
        }
    }
});

/* ---------- TOUCH CONTROLS (3×3 GRID) ---------- */
reader.addEventListener("touchstart", (e) => {
    if (reader.style.display !== "flex") return;

    const touch = e.touches[0];
    const x = touch.clientX / window.innerWidth;
    const y = touch.clientY / window.innerHeight;

    e.preventDefault();

    // TOP LEFT or TOP RIGHT → exit
    if (y < 0.33 && (x < 0.33 || x > 0.66)) {
        stopReading();
        return;
    }

    // BOTTOM LEFT → previous word
    if (y > 0.66 && x < 0.33) {
        if (index > 1) {
            index -= 2;
            renderWord(words[index]);
        }
        return;
    }

    // BOTTOM RIGHT → next word
    if (y > 0.66 && x > 0.66) {
        if (index < words.length) {
            renderWord(words[index]);
            index++;
        }
        return;
    }

    // ANYWHERE ELSE → pause / resume
    if (playing) {
        clearTimeout(timer);
        playing = false;
        reader.classList.add("paused");
    } else {
        playing = true;
        reader.classList.remove("paused");
        playNextWord();
    }
}, { passive: false });
</script>



</body>
</html>
